{"ast":null,"code":"import _regeneratorRuntime from\"/Users/wangyazhi/Documents/\\u4F5C\\u54C1\\u96C6/Platycerium-store/online-store/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/wangyazhi/Documents/\\u4F5C\\u54C1\\u96C6/Platycerium-store/online-store/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/wangyazhi/Documents/\\u4F5C\\u54C1\\u96C6/Platycerium-store/online-store/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/wangyazhi/Documents/\\u4F5C\\u54C1\\u96C6/Platycerium-store/online-store/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/wangyazhi/Documents/\\u4F5C\\u54C1\\u96C6/Platycerium-store/online-store/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/wangyazhi/Documents/\\u4F5C\\u54C1\\u96C6/Platycerium-store/online-store/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from\"react\";import Panel from\"component/Panel\";import EditInventory from\"./EditInventory\";import axios from\"commons/axios\";import{toast}from\"react-toastify\";import{withRouter}from\"react-router\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Product=/*#__PURE__*/function(_React$Component){_inherits(Product,_React$Component);var _super=_createSuper(Product);function Product(){var _this;_classCallCheck(this,Product);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.toEdit=function(){Panel.open({component:EditInventory,props:{product:_this.props.product,deleteProduct:_this.props.delete},callback:function callback(data){console.log(data);if(data){_this.props.update(data);}}});};_this.addCart=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _this$props$product,id,name,image,price,res,carts,user,result,cart,_cart;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(global.auth.isLogin()){_context.next=4;break;}_this.props.history.push(\"/login\");toast.info(\"請先登入\");return _context.abrupt(\"return\");case 4:_context.prev=4;_this$props$product=_this.props.product,id=_this$props$product.id,name=_this$props$product.name,image=_this$props$product.image,price=_this$props$product.price;_context.next=8;return axios.get(\"/carts?productId=\".concat(id));case 8:res=_context.sent;carts=res.data;user=global.auth.getUser()||{};result=carts.map(function(item,i){return item.userId;}).indexOf(user.email);if(!(carts&&result>-1&&carts.length>0)){_context.next=19;break;}cart=carts[result];cart.mount+=1;_context.next=17;return axios.put(\"/carts/\".concat(cart.id),cart);case 17:_context.next=22;break;case 19:_cart={productId:id,name:name,image:image,price:price,userId:user.email,mount:1};_context.next=22;return axios.post(\"/carts\",_cart);case 22:_context.next=27;break;case 24:_context.prev=24;_context.t0=_context[\"catch\"](4);toast.error(\"加入購物車失敗！\");case 27:_this.props.updateCartNum();toast.success(\"加入購物車成功！\");case 29:case\"end\":return _context.stop();}}},_callee,null,[[4,24]]);}));_this.renderMangerBtn=function(){var user=global.auth.getUser()||{};if(user.type===1){return/*#__PURE__*/_jsx(\"div\",{className:\"p-head has-text-right\",onClick:_this.toEdit,children:/*#__PURE__*/_jsx(\"span\",{className:\"icon edit-btn\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-sliders-h\"})})});}};return _this;}_createClass(Product,[{key:\"render\",value:function render(){var _this$props$product2=this.props.product,name=_this$props$product2.name,tags=_this$props$product2.tags,image=_this$props$product2.image,price=_this$props$product2.price,status=_this$props$product2.status;var _pClass={available:\"product\",unavailable:\"product out-stock\"};return/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(_pClass[status],\" \\\"\"),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-content\",children:[this.renderMangerBtn(),/*#__PURE__*/_jsxs(\"div\",{className:\"img-wrapper\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"out-stock-text\",children:\"\\u5DF2 \\u5B8C \\u552E\"}),/*#__PURE__*/_jsx(\"figure\",{className:\"image is-4by3\",children:/*#__PURE__*/_jsx(\"img\",{src:image,alt:name})}),/*#__PURE__*/_jsx(\"p\",{className:\"p-tags\",children:tags}),/*#__PURE__*/_jsx(\"p\",{className:\"p-name\",children:name})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-footer\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"price\",children:[\"$\",price]}),/*#__PURE__*/_jsxs(\"button\",{className:\"add-cart\",disabled:status===\"unavailable\",onClick:this.addCart,children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-shopping-cart\"}),/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-exclamation\"})]})]})]});}}]);return Product;}(React.Component);export default withRouter(Product);","map":{"version":3,"sources":["/Users/wangyazhi/Documents/作品集/Platycerium-store/online-store/src/component/Product.js"],"names":["React","Panel","EditInventory","axios","toast","withRouter","Product","toEdit","open","component","props","product","deleteProduct","delete","callback","data","console","log","update","addCart","global","auth","isLogin","history","push","info","id","name","image","price","get","res","carts","user","getUser","result","map","item","i","userId","indexOf","email","length","cart","mount","put","productId","post","error","updateCartNum","success","renderMangerBtn","type","tags","status","_pClass","available","unavailable","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport Panel from \"component/Panel\";\nimport EditInventory from \"./EditInventory\";\nimport axios from \"commons/axios\";\nimport { toast } from \"react-toastify\";\nimport { withRouter } from \"react-router\";\n\nclass Product extends React.Component {\n  toEdit = () => {\n    Panel.open({\n      component: EditInventory,\n      props: {\n        product: this.props.product,\n        deleteProduct: this.props.delete,\n      },\n      callback: (data) => {\n        console.log(data);\n        if (data) {\n          this.props.update(data);\n        }\n      },\n    });\n  };\n\n  addCart = async () => {\n    if (!global.auth.isLogin()) {\n      this.props.history.push(\"/login\");\n      toast.info(\"請先登入\");\n      return;\n    }\n\n    try {\n      const { id, name, image, price } = this.props.product;\n      const res = await axios.get(`/carts?productId=${id}`);\n      const carts = res.data;\n      const user = global.auth.getUser() || {};\n\n      const result = carts\n        .map((item, i) => {\n          return item.userId;\n        })\n        .indexOf(user.email);\n\n      if (carts && result > -1 && carts.length > 0) {\n        const cart = carts[result];\n        cart.mount += 1;\n        await axios.put(`/carts/${cart.id}`, cart);\n      } else {\n        const cart = {\n          productId: id,\n          name,\n          image,\n          price,\n          userId: user.email,\n          mount: 1,\n        };\n        await axios.post(\"/carts\", cart);\n      }\n    } catch {\n      toast.error(\"加入購物車失敗！\");\n    }\n    this.props.updateCartNum();\n    toast.success(\"加入購物車成功！\");\n  };\n\n  renderMangerBtn = () => {\n    const user = global.auth.getUser() || {};\n\n    if (user.type === 1) {\n      return (\n        <div className=\"p-head has-text-right\" onClick={this.toEdit}>\n          <span className=\"icon edit-btn\">\n            <i className=\"fas fa-sliders-h\"></i>\n          </span>\n        </div>\n      );\n    }\n  };\n\n  render() {\n    const { name, tags, image, price, status } = this.props.product;\n    const _pClass = {\n      available: \"product\",\n      unavailable: \"product out-stock\",\n    };\n    return (\n      <div className={`${_pClass[status]} \"`}>\n        <div className=\"p-content\">\n          {this.renderMangerBtn()}\n          <div className=\"img-wrapper\">\n            <div className=\"out-stock-text\">已 完 售</div>\n            <figure className=\"image is-4by3\">\n              <img src={image} alt={name} />\n            </figure>\n            <p className=\"p-tags\">{tags}</p>\n            <p className=\"p-name\">{name}</p>\n          </div>\n        </div>\n        <div className=\"p-footer\">\n          <p className=\"price\">${price}</p>\n          <button\n            className=\"add-cart\"\n            disabled={status === \"unavailable\"}\n            onClick={this.addCart}\n          >\n            <i className=\"fas fa-shopping-cart\"></i>\n            <i className=\"fas fa-exclamation\"></i>\n          </button>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default withRouter(Product);\n"]},"metadata":{},"sourceType":"module"}