{"ast":null,"code":"import _regeneratorRuntime from\"/Users/wangyazhi/Documents/\\u4F5C\\u54C1\\u96C6/Platycerium-store/online-store/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/wangyazhi/Documents/\\u4F5C\\u54C1\\u96C6/Platycerium-store/online-store/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/Users/wangyazhi/Documents/\\u4F5C\\u54C1\\u96C6/Platycerium-store/online-store/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/Users/wangyazhi/Documents/\\u4F5C\\u54C1\\u96C6/Platycerium-store/online-store/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/wangyazhi/Documents/\\u4F5C\\u54C1\\u96C6/Platycerium-store/online-store/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/wangyazhi/Documents/\\u4F5C\\u54C1\\u96C6/Platycerium-store/online-store/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/wangyazhi/Documents/\\u4F5C\\u54C1\\u96C6/Platycerium-store/online-store/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from\"react\";import ToolBox from\"./ToolBox\";import Product from\"./Product\";import axios from\"commons/axios\";import{CSSTransition,TransitionGroup}from\"react-transition-group\";import Panel from\"./Panel\";import AddInventory from\"./AddInventory\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Products=/*#__PURE__*/function(_React$Component){_inherits(Products,_React$Component);var _super=_createSuper(Products);function Products(){var _this;_classCallCheck(this,Products);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={products:[],sourceProducts:[],cartNum:0};_this.search=function(text){console.log(text);//複製新的陣列\nvar _products=_toConsumableArray(_this.state.sourceProducts);//過濾這個陣列\n_products=_products.filter(function(p){var matchArray=p.name.match(new RegExp(text,\"gi\"));return matchArray!==null;});//更新陣列\n_this.setState({products:_products});};_this.toAdd=function(){Panel.open({component:AddInventory,callback:function callback(data){if(data){_this.add(data);}console.log(\"Product \".concat(data));}});};_this.add=function(product){var _products=_toConsumableArray(_this.state.products);_products.push(product);var _sProducts=_toConsumableArray(_this.state.sourceProducts);_sProducts.push(product);_this.setState({products:_products,sourceProducts:_sProducts});};_this.update=function(product){var _products=_toConsumableArray(_this.state.products);var _index=_products.findIndex(function(p){return p.id===Product.id;});_products.splice(_index,1,product);var _sProducts=_toConsumableArray(_this.state.sourceProducts);_sProducts.splice(_index,1,product);_this.setState({products:_products,sourceProducts:_sProducts});};_this.delete=function(id){var _products=_this.state.products.filter(function(p){return p.id!==id;});var _sProducts=_this.state.sourceProducts.filter(function(p){return p.id!==id;});_this.setState({products:_products,sourceProducts:_sProducts});console.log(_this.state.products);};_this.updateCartNum=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var cartNum;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _this.initCartNum();case 2:cartNum=_context.sent;_this.setState({cartNum:cartNum});case 4:case\"end\":return _context.stop();}}},_callee);}));_this.initCartNum=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var user,res,carts,cartsNum;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:user=global.auth.getUser()||{};_context2.next=3;return axios.get(\"/carts\",{params:{userId:user.email}});case 3:res=_context2.sent;carts=res.data||[];cartsNum=carts.map(function(cart){return cart.mount;}).reduce(function(a,value){return a+value;},0);return _context2.abrupt(\"return\",cartsNum);case 7:case\"end\":return _context2.stop();}}},_callee2);}));return _this;}_createClass(Products,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;axios.get(\"/products\").then(function(response){return _this2.setState({products:response.data,sourceProducts:response.data});});this.updateCartNum();}},{key:\"render\",value:function render(){var _this3=this;return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(ToolBox,{search:this.search,cartNum:this.state.cartNum}),/*#__PURE__*/_jsxs(\"div\",{className:\"products\",children:[(global.auth.getUser()||{}).type===1&&/*#__PURE__*/_jsx(\"button\",{className:\"button is-primary add-btn\",onClick:this.toAdd,children:\"\\u52A0\\u5165\\u65B0\\u7522\\u54C1\"}),/*#__PURE__*/_jsx(\"div\",{className:\"columns is-multiline \",children:/*#__PURE__*/_jsx(TransitionGroup,{component:null,children:this.state.products.map(function(product){return/*#__PURE__*/_jsx(CSSTransition,{classNames:\"product-fade\",timeout:300,children:/*#__PURE__*/_jsx(\"div\",{className:\"column is-3-desktop is-4-tablet\",children:/*#__PURE__*/_jsx(Product,{product:product,update:_this3.update,delete:_this3.delete,updateCartNum:_this3.updateCartNum},product.id)},product.id)},product.id);})})})]})]});}}]);return Products;}(React.Component);export default Products;","map":{"version":3,"sources":["/Users/wangyazhi/Documents/作品集/Platycerium-store/online-store/src/component/Products.js"],"names":["React","ToolBox","Product","axios","CSSTransition","TransitionGroup","Panel","AddInventory","Products","state","products","sourceProducts","cartNum","search","text","console","log","_products","filter","p","matchArray","name","match","RegExp","setState","toAdd","open","component","callback","data","add","product","push","_sProducts","update","_index","findIndex","id","splice","delete","updateCartNum","initCartNum","user","global","auth","getUser","get","params","userId","email","res","carts","cartsNum","map","cart","mount","reduce","a","value","then","response","type","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport ToolBox from \"./ToolBox\";\nimport Product from \"./Product\";\nimport axios from \"commons/axios\";\nimport { CSSTransition, TransitionGroup } from \"react-transition-group\";\nimport Panel from \"./Panel\";\nimport AddInventory from \"./AddInventory\";\n\nclass Products extends React.Component {\n  state = {\n    products: [],\n    sourceProducts: [],\n    cartNum: 0,\n  };\n\n  componentDidMount() {\n    axios.get(\"/products\").then((response) =>\n      this.setState({\n        products: response.data,\n        sourceProducts: response.data,\n      })\n    );\n    this.updateCartNum();\n  }\n\n  search = (text) => {\n    console.log(text);\n    //複製新的陣列\n    let _products = [...this.state.sourceProducts];\n    //過濾這個陣列\n    _products = _products.filter((p) => {\n      const matchArray = p.name.match(new RegExp(text, \"gi\"));\n      return matchArray !== null;\n    });\n    //更新陣列\n    this.setState({\n      products: _products,\n    });\n  };\n\n  toAdd = () => {\n    Panel.open({\n      component: AddInventory,\n      callback: (data) => {\n        if (data) {\n          this.add(data);\n        }\n        console.log(`Product ${data}`);\n      },\n    });\n  };\n\n  add = (product) => {\n    const _products = [...this.state.products];\n    _products.push(product);\n    const _sProducts = [...this.state.sourceProducts];\n    _sProducts.push(product);\n    this.setState({\n      products: _products,\n      sourceProducts: _sProducts,\n    });\n  };\n\n  update = (product) => {\n    const _products = [...this.state.products];\n    const _index = _products.findIndex((p) => p.id === Product.id);\n    _products.splice(_index, 1, product);\n    const _sProducts = [...this.state.sourceProducts];\n    _sProducts.splice(_index, 1, product);\n\n    this.setState({\n      products: _products,\n      sourceProducts: _sProducts,\n    });\n  };\n\n  delete = (id) => {\n    const _products = this.state.products.filter((p) => p.id !== id);\n    const _sProducts = this.state.sourceProducts.filter((p) => p.id !== id);\n    this.setState({\n      products: _products,\n      sourceProducts: _sProducts,\n    });\n    console.log(this.state.products);\n  };\n\n  updateCartNum = async () => {\n    const cartNum = await this.initCartNum();\n    this.setState({ cartNum: cartNum });\n  };\n\n  initCartNum = async () => {\n    const user = global.auth.getUser() || {};\n    const res = await axios.get(\"/carts\", {\n      params: {\n        userId: user.email,\n      },\n    });\n    const carts = res.data || [];\n    const cartsNum = carts\n      .map((cart) => cart.mount)\n      .reduce((a, value) => a + value, 0);\n    return cartsNum;\n  };\n\n  render() {\n    return (\n      <div>\n        <ToolBox search={this.search} cartNum={this.state.cartNum} />\n\n        <div className=\"products\">\n          {(global.auth.getUser() || {}).type === 1 && (\n            <button className=\"button is-primary add-btn\" onClick={this.toAdd}>\n              加入新產品\n            </button>\n          )}\n          {/* is-desktop */}\n          <div className=\"columns is-multiline \">\n            <TransitionGroup component={null}>\n              {this.state.products.map((product) => {\n                return (\n                  <CSSTransition\n                    classNames=\"product-fade\"\n                    timeout={300}\n                    key={product.id}\n                  >\n                    <div\n                      className=\"column is-3-desktop is-4-tablet\"\n                      key={product.id}\n                    >\n                      <Product\n                        product={product}\n                        update={this.update}\n                        delete={this.delete}\n                        key={product.id}\n                        updateCartNum={this.updateCartNum}\n                      />\n                    </div>\n                  </CSSTransition>\n                );\n              })}\n            </TransitionGroup>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default Products;\n"]},"metadata":{},"sourceType":"module"}